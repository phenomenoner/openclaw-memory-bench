# Devlog — 2026-02-09

## Milestone 9: P0 hardening (schema validation + failure taxonomy)

Completed:
- Added `src/openclaw_memory_bench/validation.py` with:
  - `validate_dataset_payload`
  - `validate_retrieval_report_payload`
  - `SchemaValidationError`
- Wired validation into runtime path:
  - `cmd_prepare_dataset` now validates converted dataset before writing
  - `load_retrieval_dataset` validates JSON payload at load time
  - `run_retrieval_benchmark` validates final retrieval report before returning/saving
- Standardized runner failure shape with explicit fields:
  - `phase`
  - `error_code`
  - `error_category`
  - `retryable`
  - `exception_type`
  - `error`
- Added summary failure rollups:
  - `summary.failure_breakdown.by_code`
  - `summary.failure_breakdown.by_category`
  - `summary.failure_breakdown.by_phase`
- Added tests (`tests/test_runner_and_validation.py`):
  - success path includes failure breakdown
  - timeout path emits standardized failure metadata
  - dataset validation catches invalid relevant-session references
- Minor lint hardening: renamed ambiguous var in sidecar compare script (`l` → `latency`).

Validation:
- `uv run --python 3.13 --with pytest -- pytest -q` → 12 passed
- `uv run --python 3.13 --with ruff -- ruff check` → all checks passed

Notes:
- This remains within Phase A hardening scope; no Phase B work started.

## Milestone 10: memu extraction hardening + seeded sampling controls

Completed:
- Hardened `memu-engine` session-id extraction logic:
  - path parsing for `session-*.md/json/jsonl` (including `:line:col` suffixes)
  - snippet parsing for `[session:<id>]` markers
  - snippet parsing for `session_id: <id>` style hints
  - fallback file-token extraction from snippet text
- Added deterministic subset sampling controls in retrieval runner:
  - `--sample-size`
  - `--sample-seed` (default internal seed `0` when omitted)
  - semantics: sample first, then apply `--limit`
- Manifest/report propagation:
  - run manifest now stores `sample_size` + `sample_seed`
  - report config now stores `sample_size` + `sample_seed`
- Added tests:
  - `tests/test_memu_adapter.py` expanded session-id extraction coverage
  - `tests/test_runner_and_validation.py` now verifies seeded determinism and size guardrails
  - `tests/test_manifest.py` verifies sample parameters in manifest

## Milestone 11: memory-lancedb adapter for comprehensive benchmark set

Completed:
- Added `memory-lancedb` adapter (`src/openclaw_memory_bench/adapters/memory_lancedb.py`) using canonical memory tools via gateway:
  - ingest: `memory_store`
  - search: `memory_recall`
  - cleanup: `memory_forget`
- Added container-tag isolation strategy:
  - all ingested rows prefixed with `[container:<tag>] [session:<id>]`
  - search result filtering scoped by container marker
  - best-effort cleanup by tracked memory IDs and marker fallback
- Updated adapter registry and CLI provider support for `memory-lancedb`.
- Updated runner cleanup lifecycle:
  - best-effort per-question `adapter.clear(container_tag)` after each question to avoid leftover benchmark artifacts.
- Added tests for memory-lancedb helper parsing and adapter registration.
- Updated README with memory-lancedb usage and flags.

## Milestone 12: memory-core timeout workaround for comprehensive runs

Completed:
- Refactored `memory-core` adapter to avoid per-question hard reset + `--force` reindex pattern.
- Added one-time hard reset at adapter init, then per-container file isolation + scoped filtering.
- Added adaptive indexing retry path:
  - configurable retries/backoff
  - dynamic timeout scaling by ingest size
  - optional force-index mode retained as explicit flag
- Added ingest stabilization controls for long sessions:
  - max turns per session (head+tail)
  - max chars per message
  - max chars per session budget
- Added CLI flags for the new memory-core controls.
- Updated triplet comprehensive script to pass new memory-core tuning parameters.

## Milestone 13: preindex-once runner path + preliminary publication pack

Completed:
- Added benchmark-level `preindex_once` mode in runner:
  - ingest/index once using a global container
  - run per-question search/scoring against that indexed set
  - single cleanup at the end of run
- Exposed `--preindex-once` in CLI and propagated it to run manifest/report config.
- Added comprehensive triplet option `--memory-core-preindex-once`.
- Added runner tests for preindex-once ingest semantics (`ingest` called once).
- Added preliminary publication docs:
  - `PRELIMINARY_RESULTS.md`
  - `docs/publication/openclaw-official-discussion-draft.md`
  - `docs/publication/public-release-checklist.md`

Observation:
- Long-running memory-core preindex on longmemeval small subset can still stall in indexing paths; operationally treat memory-core as sample-only until a stable run-shape is confirmed.

## Milestone 14: interpretation-clarity update (sidecar vs backend semantics)

Completed:
- Updated `README.md` with explicit provider-role guardrails:
  - `openclaw-mem` = standalone sidecar-engine run in current benchmark adapter mode
  - `memory-core` / `memory-lancedb` = backend/canonical-memory paths
- Updated `PRELIMINARY_RESULTS.md` to state that current snapshots are provider-level and not a complete combined-stack ranking.
- Added follow-up TODO in `docs/PROJECT_PLAN_AND_TODOS.md` for a comparison-mode matrix (standalone vs combined stack runs).
- Updated public communication draft to reduce misleading interpretation risk.

## Milestone 15: upstream issue synthesis + benchmark-aligned contribution

Context:
- Reviewed and contributed to upstream OpenClaw issues:
  - #12633 (`[Bug] Session memory indexing silently skipped`)
  - #12660 (`Feature Request: Context Provider Plugin Slot`)

Bench-aligned insights captured:
- #12633 is not only a "silent skip" bug; there is also a stability class where `openclaw memory index` times out on session-heavy runs.
  - Existing benchmark artifacts already capture repeated timeout signatures (120s/240s/298s/314s) in memory-core indexing paths.
  - Implication: fix path should include both cold-start correctness and bounded bootstrap behavior.
- #12660 aligns with operational findings from token-cost analysis:
  - pricing/routing optimizations help, but token-volume control requires first-class context selection controls.
  - shadow-mode + replay-based rollout is the lowest-risk adoption path.

Recommended upstream test/telemetry additions (documented in issue comments):
1. cold-start bootstrap rule for sessions indexing when `sources` includes sessions + DB has 0 session rows + files exist on disk,
2. explicit verbose diagnostics for session-sync skip reasons,
3. regression test covering pre-existing DB + non-empty sessions directory,
4. bounded/checkpointed first-sync to reduce stall risk.

Cross-repo linkage:
- trace/replay stack (`openclaw-tracebridge`) is positioned as validation harness for context-provider rollout and fail-open gating.
- sidecar memory ops (`openclaw-mem`) remains complementary to canonical slot ownership.

## Milestone 16: triplet watchdog hardening (provider timeout + progress log + provider-failure tolerance)

Completed:
- Hardened `scripts/run_memory_triplet_comprehensive.py` with provider-level watchdog execution:
  - each provider run executes in a child process
  - new `--provider-timeout-sec` wall-time guard (default: 1500s)
  - timed-out/crashed providers are converted to structured failed provider entries instead of aborting the whole run
- Added timestamped progress logging:
  - new `--progress-log`
  - default log file: `<run-group>/progress.log`
- Added provider fail-fast control:
  - new `--fail-fast-provider` to stop remaining providers after first provider failure
- Upgraded compare schema output to include:
  - `provider_status` (`ok`/`failed`/`skipped`) with error reasons
  - `progress_log` path for debugging
- Updated README with reliability/debug controls and expected failure-tolerant behavior.
